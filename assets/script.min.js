!function(){var t=document.getElementById("year");t&&(t.textContent=(new Date).getFullYear());var e=document.getElementById("locator"),n=document.getElementById("tabList"),a=document.getElementById("tabMap"),r=document.getElementById("btnShowMap");function i(t){e&&(e.setAttribute("data-view",t),n&&n.setAttribute("aria-pressed","list"===t?"true":"false"),a&&a.setAttribute("aria-pressed","map"===t?"true":"false"),"map"===t&&B())}n&&n.addEventListener("click",(function(){i("list")})),a&&a.addEventListener("click",(function(){i("map")})),r&&r.addEventListener("click",(function(){i("map")}));var o=document.getElementById("centersList"),c=o?Array.prototype.slice.call(o.querySelectorAll(".center-card")):[],d=document.getElementById("count");function l(t){return(t||"").toString().trim().toLowerCase()}function s(){var t=l(document.getElementById("q")&&document.getElementById("q").value),e=document.getElementById("device")&&document.getElementById("device").value||"",n=0;c.forEach((function(a){var r=l(a.getAttribute("data-name")),i=l(a.getAttribute("data-address")),o=l(a.getAttribute("data-devices-label")),c=(a.getAttribute("data-devices")||"").split(",").map((function(t){return(t||"").trim()})),d=!e||c.indexOf(e)>-1,s=!t||r.indexOf(t)>-1||i.indexOf(t)>-1||o.indexOf(t)>-1,u=d&&s;a.style.display=u?"":"none",u&&n++})),d&&(d.textContent=String(n)),w()}var u=document.getElementById("btnApply"),m=document.getElementById("btnReset"),f=document.getElementById("q"),g=document.getElementById("device");function p(){c.forEach((function(t){t.classList.remove("active")}))}u&&u.addEventListener("click",s),f&&f.addEventListener("input",s),g&&g.addEventListener("change",s),m&&m.addEventListener("click",(function(){f&&(f.value=""),g&&(g.value=""),s(),p(),k()})),c.forEach((function(t){var e=t.getAttribute("data-lat"),n=t.getAttribute("data-lng"),a=t.querySelector("[data-route]");a&&e&&n&&(a.href="https://www.google.com/maps/dir/?api=1&destination="+encodeURIComponent(e+","+n))}));var v,y,h=!1,E=!1,b=document.getElementById("map"),A=document.getElementById("mapSkeleton");function I(){if(h)return Promise.resolve();var t;return(t="assets/vendor/leaflet/leaflet.css",new Promise((function(e,n){var a=document.createElement("link");a.rel="stylesheet",a.href=t,a.onload=e,a.onerror=n,document.head.appendChild(a)}))).then((function(){return t="assets/vendor/leaflet/leaflet.js",new Promise((function(e,n){var a=document.createElement("script");a.src=t,a.defer=!0,a.onload=e,a.onerror=n,document.head.appendChild(a)}));var t})).then((function(){h=!0}))}function B(){E||b&&I().then((function(){!E&&b&&window.L&&(v=L.map(b,{zoomControl:!0,scrollWheelZoom:!1,tap:!0}),y=L.layerGroup().addTo(v),L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:"&copy; OpenStreetMap"}).addTo(v),E=!0,A&&(A.style.display="none"),w(),k())})).catch((function(){A&&(A.innerHTML="<strong>خطا در بارگذاری نقشه</strong><p>فایل‌های Leaflet را در مسیر <code>assets/vendor/leaflet/</code> قرار دهید (leaflet.css و leaflet.js).</p>")}))}function F(){return c.filter((function(t){return"none"!==t.style.display}))}function w(){E&&y&&(y.clearLayers(),F().forEach((function(t){var e=parseFloat(t.getAttribute("data-lat")),n=parseFloat(t.getAttribute("data-lng"));if(isFinite(e)&&isFinite(n)){var a=t.getAttribute("data-name")||"",r=t.getAttribute("data-address")||"",i=t.getAttribute("data-phone")||"",o=L.marker([e,n]).addTo(y);o.bindPopup('<strong style="font-family:Vazir,Arial;">'+q(a)+'</strong><br><span style="font-family:Vazir,Arial;">'+q(r)+"</span><br>"+(i?'<a href="tel:'+encodeURIComponent(i)+'">تماس</a>':"")),t._marker=o}})))}function k(){if(E&&v){var t=F(),e=[];if(t.forEach((function(t){var n=parseFloat(t.getAttribute("data-lat")),a=parseFloat(t.getAttribute("data-lng"));isFinite(n)&&isFinite(a)&&e.push([n,a])})),e.length){var n=L.latLngBounds(e);v.fitBounds(n.pad(.18))}else v.setView([35.6892,51.389],11)}}function M(t){B(),function(t){p(),t.classList.add("active")}(t);var e=parseFloat(t.getAttribute("data-lat")),n=parseFloat(t.getAttribute("data-lng"));isFinite(e)&&isFinite(n)&&setTimeout((function(){E&&v&&(v.setView([e,n],14,{animate:!0}),t._marker&&t._marker.openPopup&&t._marker.openPopup())}),250)}!function(){if("IntersectionObserver"in window){var t=document.getElementById("mapSection");if(t){var e=new IntersectionObserver((function(t){t.forEach((function(t){t.isIntersecting&&(B(),e.disconnect())}))}),{rootMargin:"250px"});e.observe(t)}}}(),c.forEach((function(t){t.addEventListener("click",(function(e){e&&e.target&&"A"===e.target.tagName||M(t)}));var e=t.querySelector("[data-focus]");e&&e.addEventListener("click",(function(e){e.stopPropagation(),M(t),i("map")}))}));var x=document.getElementById("btnNearest");function q(t){return(t||"").replace(/[&<>"']/g,(function(t){return{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[t]}))}x&&x.addEventListener("click",(function(){navigator.geolocation?navigator.geolocation.getCurrentPosition((function(t){var e=t.coords.latitude,n=t.coords.longitude,a=null,r=1/0;F().forEach((function(t){var i=parseFloat(t.getAttribute("data-lat")),o=parseFloat(t.getAttribute("data-lng"));if(isFinite(i)&&isFinite(o)){var c=function(t,e,n,a){function r(t){return t*Math.PI/180}var i=6371,o=r(n-t),c=r(a-e),d=Math.sin(o/2)*Math.sin(o/2)+Math.cos(r(t))*Math.cos(r(n))*Math.sin(c/2)*Math.sin(c/2),l=2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d));return i*l}(e,n,i,o);c<r&&(r=c,a=t)}})),a?(M(a),i("map")):alert("مرکزی با مختصات معتبر پیدا نشد.")}),(function(){alert("دسترسی موقعیت مکانی داده نشد.")}),{enableHighAccuracy:!1,timeout:7e3,maximumAge:6e4}):alert("مرورگر شما از موقعیت مکانی پشتیبانی نمی‌کند.")})),s()}();